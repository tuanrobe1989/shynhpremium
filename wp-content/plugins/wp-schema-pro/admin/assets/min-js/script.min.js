!function(n){const r={container:"",init(){const t=this;t.container=n("#aiosrs-schema-settings, #aiosrs-pro-custom-fields"),n(document).ready(function(){n(".select2-class").select2();var s=["Site Meta","Post Meta (Basic Fields)"];if("custom-markup"===n("#bsf-aiosrs-schema-type").val())for(let e=0;e<s.length;e++)n('#bsf-aiosrs-custom-markup-custom-markup optgroup[label="'+s[e]+'"]').remove();var t=n("#custom-schema-schema-field").val();if(t)for(let e=0;e<s.length;e++)n("#custom-markup-"+t+'-custom-markup-connected optgroup[label="'+s[e]+'"]').remove()}),t.container.on("change","select.bsf-aiosrs-schema-meta-field",function(){const e=n(this),s=e.parent(),t=e.val(),a=s.find(".bsf-aiosrs-schema-custom-text-wrap");"custom-text"===t?a.removeClass("bsf-hidden-field"):a.hasClass("bsf-hidden-field")||a.addClass("bsf-hidden-field");const i=s.find(".bsf-aiosrs-schema-fixed-text-wrap");"fixed-text"===t?i.removeClass("bsf-hidden-field"):i.hasClass("bsf-hidden-field")||i.addClass("bsf-hidden-field");const r=s.find(".bsf-aiosrs-schema-specific-field-wrap");"specific-field"===t?r.removeClass("bsf-hidden-field"):r.hasClass("bsf-hidden-field")||r.addClass("bsf-hidden-field")}),t.container.on("change",".bsf-aiosrs-schema-row-rating-type select.bsf-aiosrs-schema-meta-field",function(e){if(e.preventDefault(),n(this).closest(".bsf-aiosrs-schema-table").find(".bsf-aiosrs-schema-row").css("display",""),"accept-user-rating"===n(this).val()){const s=n(this).closest(".bsf-aiosrs-schema-row").next(".bsf-aiosrs-schema-row"),t=s.find(".bsf-aiosrs-schema-meta-field").attr("name");e=jQuery(".bsf-aiosrs-review-schema-type").val();e&&0<=t.indexOf("bsf-aiosrs-review["+e+"-review-count]")&&s.hide(),0<=t.indexOf("[review-count]")&&s.hide()}}),t.container.find("select.bsf-aiosrs-schema-meta-field").trigger("change"),n("select.bsf-aiosrs-schema-select2").each(function(e,s){t.init_target_rule_select2(s)}),t.container.on("click",".bsf-repeater-add-new-btn",function(e){e.preventDefault(),t.add_new_repeater(n(this)),t.prepare_event_schmea_fields()}),t.container.on("click",".bsf-repeater-close",function(e){e.preventDefault(),t.add_remove_repeater(n(this))}),t.schemaTypeDependency(),t.bindTooltip(),n("body").hasClass("post-type-aiosrs-schema")||t.field_validation()},field_validation(){n(".wpsp-custom-field-connect, .wpsp-field-close, .bsf-aiosrs-schema-meta-field, image-field-wrap, .aiosrs-pro-custom-field, .wpsp-custom-field-connect").on("click focus change",function(){n(".bsf-aiosrs-schema-type-wrap").each(function(e,s){let t=n(s).find(".wpsp-default-hidden-value").val();const a=n(s).parents(".bsf-aiosrs-schema-row-content").prev();if(void 0!==t)if(t=t.trim(),t)if(n("body").hasClass("block-editor-page"))if(n(s).find(".wpsp-required-error-field").length)a.removeClass("wpsp-required-error-field"),a.find("label").removeClass("wpsp-required-error-field");else{let e;switch(t){case"post_title":e=n(".editor-post-title__input").val();break;case"post_content":e=1<n("p.block-editor-rich-text__editable").text().length?n("p.block-editor-rich-text__editable").text():"";break;case"post_excerpt":e=n(".components-textarea-control__input").val();break;case"featured_img":e="Set featured image"===n(".editor-post-featured-image__toggle").text()?"":n(".components-responsive-wrapper__content").attr("src");break;default:a.removeClass("wpsp-required-error-field"),a.find("label").removeClass("wpsp-required-error-field")}void 0!==e&&(""!==e?(a.removeClass("wpsp-required-error-field"),a.find("label").removeClass("wpsp-required-error-field")):a.find(".required").length&&a.find("label").addClass("wpsp-required-error-field"))}else a.removeClass("wpsp-required-error-field"),a.find("label").removeClass("wpsp-required-error-field");else a.find(".required").length&&a.find("label").addClass("wpsp-required-error-field")})})},hide_review_count(){if(n(this).closest(".bsf-aiosrs-schema-table").find(".bsf-aiosrs-schema-row").css("display",""),"accept-user-rating"===n(this).val()){const s=n(this).closest(".bsf-aiosrs-schema-row").next(".bsf-aiosrs-schema-row"),t=s.find(".bsf-aiosrs-schema-meta-field").attr("name");var e=jQuery(".bsf-aiosrs-review-schema-type").val();e&&0<=t.indexOf("bsf-aiosrs-review["+e+"-review-count]")&&s.hide(),0<=t.indexOf("[review-count]")&&s.hide()}},add_new_repeater(e){const t=this,s=e.closest(".bsf-aiosrs-schema-type-wrap"),a=s.find(".aiosrs-pro-repeater-table-wrap").length,i=s.find(".aiosrs-pro-repeater-table-wrap").first().clone();i.find(".bsf-aiosrs-schema-custom-text-wrap, .bsf-aiosrs-schema-specific-field-wrap").each(function(){n(this).hasClass("bsf-hidden-field")||n(this).addClass("bsf-hidden-field")}),i.find("select.bsf-aiosrs-schema-meta-field").each(function(){n(this).val("none");var e=void 0!==n(this).attr("name")?n(this).attr("name").replace("[0]","["+a+"]"):"",s=void 0!==n(this).attr("class")?n(this).attr("class").replace("-0-","-"+a+"-"):"",t=void 0!==n(this).attr("id")?n(this).attr("id").replace("-0-","-"+a+"-"):"";n(this).attr("name",e),n(this).attr("class",s),n(this).attr("id",t)}),i.find("input, textarea, select:not(.bsf-aiosrs-schema-meta-field)").each(function(){n(this).val("");var e=void 0!==n(this).attr("name")?n(this).attr("name").replace("[0]","["+a+"]"):"",s=void 0!==n(this).attr("class")?n(this).attr("class").replace("-0-","-"+a+"-"):"",t=void 0!==n(this).attr("id")?n(this).attr("id").replace("-0-","-"+a+"-"):"";n(this).attr("name",e),n(this).attr("class",s),n(this).attr("id",t)}),i.find("span.select2-container").each(function(){n(this).remove()}),i.insertBefore(e),i.find("select.bsf-aiosrs-schema-select2").each(function(e,s){t.init_target_rule_select2(s)}),r.init_date_time_fields()},add_remove_repeater(e){const s=e.closest(".bsf-aiosrs-schema-type-wrap"),t=s.find("> .aiosrs-pro-repeater-table-wrap").length;1<t&&(e.closest(".aiosrs-pro-repeater-table-wrap").remove(),"aiosrs-pro-custom-fields"===this.container.attr("id")&&s.find("> .aiosrs-pro-repeater-table-wrap").each(function(a,e){n(e).each(function(e,s){n(s).find("input, textarea, select:not(.bsf-aiosrs-schema-meta-field)").each(function(e,s){var t=void 0!==n(s).attr("name")?n(s).attr("name").replace(/\[\d+]/,"["+a+"]"):"";n(s).attr("name",t)})})}))},bindTooltip(){n(".bsf-aiosrs-schema-heading-help").tooltip({content(){return n(this).prop("title")},tooltipClass:"bsf-aiosrs-schema-ui-tooltip",position:{my:"center top",at:"center bottom+10"},hide:{duration:200},show:{duration:200}})},schemaTypeDependency(){const s=this.container;this.container.on("change",'select[name="bsf-aiosrs-schema-type"]',function(){s.find(".bsf-aiosrs-schema-meta-wrap").css("display","none");var e=n(this).val();void 0!==e&&""!==e&&s.find("#bsf-"+e+"-schema-meta-wrap").css("display","")})},init_target_rule_select2(e){n(e).select2({placeholder:"Search Fields...",ajax:{url:ajaxurl,dataType:"json",method:"post",delay:250,data(e){return{nonce_ajax:AIOSRS_Rating.specified_field,q:e.term,page:e.page,action:"bsf_get_specific_meta_fields"}},processResults(e){return{results:e}},cache:!0},minimumInputLength:2})},get_review_item_type_html(s){jQuery.post({url:ajaxurl,data:{action:"fetch_item_type_html",itemType:s,nonce:AIOSRS_Rating.security,post_id:jQuery("#post_ID").val()}}).done(function(e){n(".bsf-review-item-type-field").remove(),n(e).insertAfter(jQuery("#bsf-aiosrs-review-schema-type").parent().parent().closest("tr")),n("select.bsf-aiosrs-schema-select2").each(function(e,s){r.init_target_rule_select2(s)}),n(".bsf-aiosrs-review-"+s+"-rating").each(function(){if(n(this).closest(".bsf-aiosrs-schema-table").find(".bsf-aiosrs-schema-row").css("display",""),"accept-user-rating"===n(this).val()){const s=n(this).closest(".bsf-aiosrs-schema-row").next(".bsf-aiosrs-schema-row"),t=s.find(".bsf-aiosrs-schema-meta-field").attr("name");var e=jQuery(".bsf-aiosrs-review-schema-type").val();e&&0<=t.indexOf("bsf-aiosrs-review["+e+"-review-count]")&&s.hide(),0<=t.indexOf("[review-count]")&&s.hide()}}),r.init_date_time_fields(),r.prepare_event_schmea_fields()}).fail(function(){})},prepare_event_schmea_fields(){n(".wpsp-dropdown-event-status, .wpsp-dropdown-bsf-aiosrs-event-event-status").change(function(){const e=n(this).parents(".bsf-aiosrs-schema-meta-wrap, .aiosrs-pro-meta-fields-wrap");e.find("td.wpsp-event-status-rescheduled, td.bsf-aiosrs-review-bsf-aiosrs-event-previous-date").hide(),this.value||(this.value="EventScheduled"),"EventRescheduled"===this.value&&e.find("td.wpsp-event-status-rescheduled, td.bsf-aiosrs-review-bsf-aiosrs-event-previous-date").show();var s=n(".wpsp-dropdown-event-attendance-mode, .wpsp-dropdown-bsf-aiosrs-event-event-attendance-mode").val();"EventMovedOnline"===this.value||"OfflineEventAttendanceMode"!==s?(e.find("td.wpsp-event-status-offline").hide(),e.find("td.wpsp-event-status-online").show(),e.find(".wpsp-dropdown-event-attendance-mode, .wpsp-dropdown-bsf-aiosrs-event-event-attendance-mode").val("OnlineEventAttendanceMode")):(e.find("td.wpsp-event-status-offline").show(),e.find("td.wpsp-event-status-online").hide())}),n(".wpsp-dropdown-event-attendance-mode, .wpsp-dropdown-bsf-aiosrs-event-event-attendance-mode").change(function(){const e=n(this).parents(".bsf-aiosrs-schema-meta-wrap, .aiosrs-pro-meta-fields-wrap");e.find("td.wpsp-event-status-rescheduled").hide(),"EventMovedOnline"!==n(".wpsp-dropdown-event-status, .wpsp-dropdown-bsf-aiosrs-event-event-status").val()&&(e.find("td.wpsp-event-status-offline").show(),e.find("td.wpsp-event-status-online").hide()),"OfflineEventAttendanceMode"!==this.value&&(e.find("td.wpsp-event-status-offline").hide(),e.find("td.wpsp-event-status-online").show()),"MixedEventAttendanceMode"===this.value&&(e.find("td.wpsp-event-status-offline").show(),e.find("td.wpsp-event-status-online").show())}),n(".wpsp-dropdown-event-attendance-mode, .wpsp-dropdown-bsf-aiosrs-event-event-attendance-mode").trigger("change")},init_date_time_fields(){n(".wpsp-datetime-local-field, .wpsp-date-field, .wpsp-time-duration-field").each(function(){n(this).removeClass("hasDatepicker")});const t=".wpsp-date-published-date, .wpsp-datetime-local-event-start-date, .wpsp-date-start-date, .wpsp-datetime-local-start-date",a=".wpsp-date-modified-date, .wpsp-datetime-local-event-end-date, .wpsp-date-end-date, .wpsp-datetime-local-end-date";n(document).on("focus",".wpsp-time-duration-field",function(){n(this).timepicker({timeFormat:"HH:mm:ss",hourMin:0,hourMax:99,oneLine:!0,currentText:"Clear",onSelect(){!function(e){const s=n(e).closest(".aiosrs-pro-custom-field-time-duration"),t=s.find(".time-duration-field");let a=n(e).val();a=a.replace(/:/,"H"),a=a.replace(/:/,"M"),a="PT"+a+"S",t.val(a);const i=n(e).parents(".wpsp-local-fields");i.find(".wpsp-default-hidden-value").val(a)}(this)}})}),n(document).on("focus",".wpsp-datetime-local-field, .wpsp-date-field",function(){n(this).datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"hh:mm TT",changeMonth:!0,changeYear:!0,showOn:"focus",showButtonPanel:!0,closeText:"Done",currentText:"Clear",yearRange:"-100:+10",onClose(e,s){s="#"+s.id;jQuery(s).is(t)?n(a).datetimepicker("option","minDate",new Date(e)):jQuery(s).is(a)&&n(t).datetimepicker("option","maxDate",new Date(e)),jQuery(s).parents(".wpsp-local-fields").find(".wpsp-default-hidden-value").val(e)}})}),n.datepicker._gotoToday=function(e){n(e).datepicker("setDate","").datepicker("hide").blur()}}};n(function(){r.init(),n("body").hasClass("aiosrs-pro-setup")||r.init_date_time_fields()}),n(document).ready(function(){n("#bsf-aiosrs-review-schema-type").change(function(){var e=n(this).val().trim();e?r.get_review_item_type_html(e):n(".bsf-review-item-type-field").remove()}),n("#bsf-aiosrs-review-schema-type").change(),r.prepare_event_schmea_fields()})}(jQuery);